@model Cynfo1._0.ViewModels.AdFormViewModel
@{
    ViewBag.Title = "Nuevo Anuncio";
    Layout = "~/Views/Shared/_Layout.cshtml";
   

}





@if (!Model.Beacons.Any())
{
    <p>No se ha definido ningun Area para publicar este anuncio</p>
}
else
{
    <br />
    <br />

    <div class="w3-row">
        <div class="w3-col w3-container" style="width: 20%"> </div>

        <div class="w3-col" style="width: 60%">
            <div class="w3-container w3-teal">
                @if (Model.Advertisement.Id == 0)
                {
                    <h2 class="w3-left">
                        Nuevo Anuncio

                    </h2>
                    <a href="@Url.Action("Index", "Advertisements")"> <i class="fa fa-times fa-2x fa-fw w3-right w3-padding-8"></i></a>

                }
                else
                {
                    <h2>
                        Editar Anuncio
                    </h2>
                }

            </div>

            <div class="w3-container w3-card-4 w3-white">
                @using (Html.BeginForm("Save", "Advertisements", FormMethod.Post, new { enctype = "multipart/form-data", id = "adsForm", @class = "" }))
                {
                    <div class="w3-container">
                        <br />
                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                        <div class="w3-container">
                            @Html.LabelFor(m => m.Advertisement.Title, htmlAttributes: new { @class = " w3-label" })
                            @Html.TextBoxFor(m => m.Advertisement.Title, new { @class = "w3-input " })
                            @Html.ValidationMessageFor(m => m.Advertisement.Title)

                        </div>
                        <br/>

                        <div class="w3-container col-md-12">
                            @Html.LabelFor(m => m.Advertisement.ExpirationDate, htmlAttributes: new { @class = " w3-label"})
                            @Html.TextBoxFor(m => m.Advertisement.ExpirationDate, new { @class = "w3-input", id = "datetimepicker" })
                            @Html.ValidationMessageFor(m => m.Advertisement.ExpirationDate)
                            <br />
                 
                        </div>
              
               
                        <br/>

                        <div class="w3-container">

                            <label class="w3-label">Area de publicación</label>
                            <div>
                                @Html.DropDownListFor(m => m.Advertisement.BeaconId, new SelectList(Model.Beacons, "Id", "AreaName"), "-Seleccione el Area-", new { @class = "w3-select w3-border-teal" })
                                @Html.ValidationMessageFor(m => m.Advertisement.BeaconId)
                            </div>

                        </div>
                        <br />

                        <div class="w3-container">
                            @Html.LabelFor(m => m.Advertisement.Description, htmlAttributes: new { @class = "w3-label" })
                            @Html.TextAreaFor(m => m.Advertisement.Description, new { @class = "w3-input" })
                            @Html.ValidationMessageFor(m => m.Advertisement.Description)

                        </div>
                        <br />

                        @if (Model.Advertisement.Id != 0)
                        {
                            <br />
                            <div class="w3-container">
                                <img src="@Model.Advertisement.MediaURL" class="w3-animate-zoom " alt="Anuncio" style="width: 100%" />

                            </div>
                            <br />
                            <div class="w3-container">
                                <label class="w3-label"> Imagen del Anuncio</label>
                                <input type="file" name="photo" class="file" />
                             
                            </div>
                        }

                        else
                        {
                            <div class="w3-container">
                                <label class="w3-label"> Imagen del Anuncio</label>
                                <input type="file" name="photo" class="file" data-val="true" data-allowed-file-extensions='["jpeg", "png"]' data-val-required="La imagen es obligatoria" />
                                <span class="field-validation-valid" data-valmsg-for="photo" data-valmsg-replace="true"></span>
                            </div>
                        }
                        @Html.HiddenFor(m => m.Advertisement.Id)
                        @Html.AntiForgeryToken()


                        <br />
                        <button type="submit" class="w3-btn w3-quarter">Guardar</button>

                    </div>

                }
            </div>



        </div>
        <div class="w3-col" style="width: 20%"> </div>
    </div>

}





@section scripts
{


<script type="text/javascript" src="/scripts/moment.min.js"></script>
<script type="text/javascript" src="/scripts/bootstrap-datetimepicker.min.js"></script>


    <script>

        $(document).ready(function () {

            $('#datetimepicker').datetimepicker();

            $('#adsForm').on('submit', function (e) {
                var form = $("#adsForm");
                form.validate();

                if (form.valid()) {
                    e.preventDefault();
                    var dialog = bootbox.dialog({

                        message: '<div class="w3-center">' +
                            '<div class=""><i class="fa fa-cog fa-spin fa-3x fa-fw"></i></div>' +
                            '<p class="">Espere mientras se publica el anuncio</p>' +
                            '</div> ',
                        closeButton: false,
                        title: '<div class="w3-center">Procesando Anuncio</div>'

                    });

                    var url = $(this).attr("action");
                    console.log(url);
                    var formData = new FormData($(this)[0]);
                    $.ajax({
                        url: url,
                        type: "POST",
                        data: formData,
                        success: function (resp) {
                            console.log("Created Succesfully");

                            window.location.href = '/Advertisements/Index';

                        },
                        contentType: false,
                        processData: false,
                        error: function (jqXHR, status, error) {
                            console.log(jqXHR);
                            console.log(status);
                            console.log(error);

                        }

                    });

                } else {

                    console.log("Invalid");
                    return null;
                }




            });


        });


    </script>

}
